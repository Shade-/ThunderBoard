var ThunderBoard={templates:null,timeout:4e3,selector:"#thunderboard-container",location:null,errors:{threshold:10,counter:0},isLoading:!1,customAttributes:{outAnimations:[],inAnimations:[],reverseAnimation:""},init:function(){if(!Turbolinks.supported)return!1;var t=Cookie.get("tb-templates"),e=$(document);t&&"undefined"!=typeof Storage&&(this.templates=this.storage.getTemplates()),this.templates||$.ajax({type:"GET",url:"thunderboard.php",success:function(t){if((t=$.parseJSON(t)).error)return console.log(t.error);ThunderBoard.storage.saveTemplates(t)}});$(this.selector);var n=$("#header").outerHeight(),r=$("#footer").outerHeight(),o=function(t,e){for(var n="",r=0;r<e.length;r++){var o=String(e[r].page);n=-1!==o.indexOf(",")?o.split(","):[o];for(var a=0;a<n.length;a++)if(-1!==t.indexOf(n[a]))return e[r].template}return""},a=function(t){var e="";if(t.originalEvent.data.url&&ThunderBoard.templates&&(e=o(t.originalEvent.data.url,ThunderBoard.templates)),e||(e=o("global",ThunderBoard.templates)),e){for(var a,i,d,s,l,u,c,h=/\{(.*?)\}/g;match=h.exec(e);){for(d=(i=match[1].split("|"))[0].replace(/[^a-zA-Z0-9]/g,""),s=i[1],l=ThunderBoard.component,u="",c="";!c.length&&(u=l,(l=void 0!==l?l.parent().closest("*[data-tb-item]"):"").length)&&(c=l.find("*[data-tb-"+d+"], "+i[0]).first(),!l.is(u)););if(a=c.length?s?c.attr(s):c.html():"","subject"!=d||a||(a=ThunderBoard.component.text()),e=e.replace(match[0],a),a){var m=$(e).clone().wrap("<div>").find("*[data-tb-"+d+"], "+i[0]).first().closest(".placeholder").removeClass("placeholder").removeAttr("style").find(".placeholder").removeClass("placeholder").removeAttr("style").end().end().end().end().parent().html();m&&(e=m)}}$("[data-thunderboard]:last")[0].innerHTML=e,$("#content").css({"min-height":$(window).height()-n-r+"px"})}};window.onerror=function(t,e,n,r,o){if(o instanceof ReferenceError){ThunderBoard.errors.counter>=ThunderBoard.errors.threshold&&window.location.reload();var a=/referenceerror:(.*?)is not defined/gi.exec(t);a=a[1].trim();var i=setInterval(function(t){return void 0!==window[t]&&($("script:contains("+t+")").appendTo("body"),document.dispatchEvent(new Event("turbolinks:load")),ThunderBoard.errors.counter++,clearInterval(i))},200,a);return!0}return!1},ThunderBoard.location=window.location.pathname,Turbolinks.Location.prototype.isHTML=function(){var t=this.getExtension();return null==t||".html"===t||t.match(/^(?:|\.(?:htm|html|xhtml|php))$/)},Turbolinks.setProgressBarDelay(1e6);ThunderBoard.customAttributes.outAnimations,ThunderBoard.customAttributes.inAnimations;e.on("turbolinks:click",function(t){if(new URL(t.originalEvent.data.url).pathname!=ThunderBoard.location)return!1;ThunderBoard.isLoading=!0,$("body > *:not([data-thunderboard-context])").remove();var e=$("[tb-animation]"),n=e.length;$.each(e,function(e,r){var o=(r=$(r)).attr("tb-animation").split(",");o[1]||(o[1]=o[0]),r.addClass(o[1]+" "+ThunderBoard.customAttributes.reverseAnimation).off("webkitAnimationEnd oanimationend msAnimationEnd animationend"),e==n-1&&setTimeout(function(){return!!ThunderBoard.isLoading&&a(t)},500,t)}),n||a(t)}),e.on("turbolinks:load",function(t){ThunderBoard.isLoading=!1,void 0!==t.originalEvent.data&&void 0!==t.originalEvent.data.timing.visitStart&&ThunderBoard.location!=window.location.href&&$.each($("[tb-animation]"),function(t,e){var n=(e=$(e)).attr("tb-animation").split(",");e.addClass(n[0]).one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){$(this).removeClass(function(t,e){return(e.match(/(^|\s)uk-animation-\S+/g)||[]).join(" ")})})}),ThunderBoard.location=window.location.pathname}),e.on("submit",'form[method="get"]',function(t){t.preventDefault(),t.stopImmediatePropagation();var e=$(this);Turbolinks.visit(e.attr("action")+"?"+e.serialize())})},storage:{getTemplates:function(){obj=localStorage.thunderboardTemplates;try{obj=JSON.parse(obj)}catch(t){obj=null}return obj},saveTemplates:function(t){return localStorage.thunderboardTemplates=JSON.stringify(t),ThunderBoard.templates=t,Cookie.set("tb-templates",(new Date).getTime()/1e3)}}};ThunderBoard.init();
